name: ðŸ”‘ [Common] Create Web env file

on:
  workflow_call:
    inputs:
      ENV:
        description: 'Environment name (preview/production)'
        type: string
        required: true
    secrets:
      # Webç”¨ç’°å¢ƒå¤‰æ•°  
      NEXT_PUBLIC_API_URL:
        required: true
      # NextAuth.jsé–¢é€£
      NEXTAUTH_URL:
        required: true
      NEXTAUTH_SECRET:
        required: true
      GOOGLE_CLIENT_ID:
        required: true
      GOOGLE_CLIENT_SECRET:
        required: true
      # Basicèªè¨¼é–¢é€£
      BASIC_AUTH_USER:
        required: true
      BASIC_AUTH_PASSWORD:
        required: true

env:
  ENV: ${{ inputs.ENV }}

jobs:
  # Webç”¨ã® .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€Artifactã¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
  create:
    runs-on: ubuntu-latest
    steps:
      - name: Create Web .env file for ${{ env.ENV }}
        env:
          NEXT_PUBLIC_API_URL: ${{ secrets.NEXT_PUBLIC_API_URL }}
          NEXTAUTH_URL: ${{ secrets.NEXTAUTH_URL }}
          NEXTAUTH_SECRET: ${{ secrets.NEXTAUTH_SECRET }}
          AUTH_TRUST_HOST: "true"
          GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
          GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
          ADMIN_EMAILS: ${{ vars.ADMIN_EMAILS }}
          BASIC_AUTH_USER: ${{ secrets.BASIC_AUTH_USER }}
          BASIC_AUTH_PASSWORD: ${{ secrets.BASIC_AUTH_PASSWORD }}
        run: |
          ENV_FILE=".env"
          echo "Creating Web $ENV_FILE for ${{ env.ENV }} environment..."
          
          # API URL
          echo "NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL" >> $ENV_FILE
          
          # NextAuth.jsé–¢é€£
          echo "NEXTAUTH_URL=$NEXTAUTH_URL" >> $ENV_FILE
          echo "NEXTAUTH_SECRET=$NEXTAUTH_SECRET" >> $ENV_FILE
          echo "AUTH_TRUST_HOST=$AUTH_TRUST_HOST" >> $ENV_FILE
          
          # Google OAuth
          echo "GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID" >> $ENV_FILE
          echo "GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET" >> $ENV_FILE
          
          # ç®¡ç†è€…è¨­å®š
          echo "ADMIN_EMAILS=$ADMIN_EMAILS" >> $ENV_FILE
          
          # Basicèªè¨¼è¨­å®š
          echo "BASIC_AUTH_USER=$BASIC_AUTH_USER" >> $ENV_FILE
          echo "BASIC_AUTH_PASSWORD=$BASIC_AUTH_PASSWORD" >> $ENV_FILE
          
          echo "âœ… Created Web $ENV_FILE with ${{ env.ENV }} configuration"

      - name: Upload .env as an artifact
        uses: actions/upload-artifact@v4
        with:
          name: web-env-file-${{ env.ENV }}
          path: .env
          include-hidden-files: true