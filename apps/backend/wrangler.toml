# Cloudflare Workers configuration for Hono backend
name = "saneatsu-api"
main = "src/index.ts"
compatibility_date = "2024-12-01"

# Node.js compatibility for full Hono features
compatibility_flags = ["nodejs_compat"]

# Enable Workers logging
[observability]
enabled = true

# Development configuration
[env.development]
name = "saneatsu-backend-dev"

# Service binding to frontend
[[env.development.services]]
binding = "FRONTEND_WEB"
service = "saneatsu-web-dev"

[env.development.vars]
NODE_ENV = "development"
CORS_ORIGIN = "http://localhost:3333"

# Preview/staging environment
[env.preview]
name = "saneatsu-backend-preview"

# Service binding to frontend
[[env.preview.services]]
binding = "FRONTEND_WEB"
service = "saneatsu-web-preview"

[env.preview.vars]
NODE_ENV = "preview"
CORS_ORIGIN = "https://saneatsu.me"

# Production environment
[env.production]
name = "saneatsu-backend"

# Service binding to frontend
[[env.production.services]]
binding = "FRONTEND_WEB"
service = "saneatsu-web"

[env.production.vars]
NODE_ENV = "production"
CORS_ORIGIN = "https://saneatsu.me"

# Custom domain configuration for production
[[env.production.routes]]
pattern = "api.saneatsu.me/*"
zone_name = "saneatsu.me"

# Build configuration
[build]
command = "pnpm build"
