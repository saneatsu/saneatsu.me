# Lefthook configuration
# https://lefthook.dev/configuration/

# pre-commit フック設定
pre-commit:
  parallel: false  # テストが順番に実行されるようにする
  commands:
    # Biomeでコードフォーマットとlintを実行
    biome:
      run: pnpm exec biome check --write --no-errors-on-unmatched {staged_files}
      glob: "*.{js,jsx,ts,tsx,mjs,cjs,json,md,yml,yaml}"

    # TypeScriptの型チェック
    type-check:
      run: pnpm type-check
      # 型チェックは全体を対象にするため、staged_filesは使わない

    # apps/backendのVitestを実行
    backend-test:
      run: cd apps/backend && pnpm test run
      # test runでwatchモードを無効化

    # apps/frontendのVitestを実行
    frontend-test:
      run: cd apps/frontend && pnpm test run
      # test runでwatchモードを無効化

    # apps/frontendのStorybook テストを実行
    storybook-test:
      run: cd apps/frontend && pnpm test-storybook:smart
      # test-storybook:smartは既存サーバーがあれば使用、なければCI modeで起動

# commit-msg フック設定
commit-msg:
  commands:
    commitlint:
      run: pnpm exec commitlint --edit {1}
